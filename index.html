<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Katsuy≈ç Academy ‚Äî Japanese Verb Conjugation</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --ink: #1a1a2e;
      --ink-light: #2d2d44;
      --paper: #faf9f7;
      --paper-warm: #f5f3ef;
      --accent: #c45c4a;
      --accent-soft: #d4786a;
      --sage: #7a9e7e;
      --gold: #c9a962;
      --text: #3d3d3d;
      --text-light: #6b6b6b;
    }
    
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--paper);
      color: var(--text);
      line-height: 1.6;
    }
    
    .jp {
      font-family: 'Noto Serif JP', serif;
    }
    
    /* NAVIGATION */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: var(--ink);
      border-bottom: 3px solid var(--accent);
    }
    
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 72px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .logo:hover {
      opacity: 0.85;
    }
    
    .logo-kanji {
      font-size: 1.75rem;
      color: var(--accent);
      font-weight: 700;
    }
    
    .logo-text {
      color: var(--paper);
      font-size: 1.35rem;
      font-weight: 600;
      letter-spacing: -0.02em;
    }
    
    .nav-links {
      display: flex;
      gap: 2.5rem;
    }
    
    .nav-link {
      color: var(--paper);
      opacity: 0.7;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      padding: 0.5rem 0;
      border: none;
      background: none;
      position: relative;
      font-family: inherit;
    }
    
    .nav-link:hover, .nav-link.active {
      opacity: 1;
    }
    
    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
    }
    
    /* PAGES */
    .page {
      min-height: 100vh;
      padding-top: 72px;
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    /* HOME PAGE */
    .home {
      display: flex;
      flex-direction: column;
    }
    
    .hero {
      min-height: calc(100vh - 72px);
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--ink) 0%, var(--ink-light) 100%);
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: 'Ê¥ªÁî®';
      position: absolute;
      font-size: 35vw;
      color: rgba(255,255,255,0.02);
      font-family: 'Noto Serif JP', serif;
      font-weight: 700;
      pointer-events: none;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .hero-content {
      text-align: center;
      padding: 3rem;
      position: relative;
      z-index: 1;
    }
    
    .hero-badge {
      display: inline-block;
      background: var(--accent);
      color: var(--paper);
      padding: 0.4rem 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 2rem;
    }
    
    .hero-title {
      color: var(--paper);
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 700;
      letter-spacing: -0.03em;
      margin-bottom: 0.5rem;
      line-height: 1.1;
    }
    
    .hero-subtitle {
      color: var(--accent-soft);
      font-size: clamp(1.25rem, 3vw, 1.75rem);
      font-weight: 300;
      margin-bottom: 2rem;
    }
    
    .hero-desc {
      color: rgba(255,255,255,0.6);
      font-size: 1.1rem;
      max-width: 500px;
      margin: 0 auto 3rem;
      line-height: 1.7;
    }
    
    .hero-cta {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.25s;
      font-family: inherit;
    }
    
    .btn-primary {
      background: var(--accent);
      color: var(--paper);
    }
    
    .btn-primary:hover {
      background: var(--accent-soft);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: transparent;
      color: var(--paper);
      border: 2px solid rgba(255,255,255,0.3);
    }
    
    .btn-secondary:hover {
      border-color: var(--paper);
      background: rgba(255,255,255,0.05);
    }
    
    /* FEATURES */
    .features {
      padding: 6rem 2rem;
      background: var(--paper-warm);
    }
    
    .features-inner {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .features-header {
      text-align: center;
      margin-bottom: 4rem;
    }
    
    .features-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--ink);
      margin-bottom: 0.75rem;
    }
    
    .features-subtitle {
      color: var(--text-light);
      font-size: 1.1rem;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
    }
    
    .feature-card {
      background: var(--paper);
      padding: 2.5rem 2rem;
      border: 1px solid rgba(0,0,0,0.06);
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      border-color: var(--accent);
    }
    
    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 1.25rem;
    }
    
    .feature-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 0.75rem;
    }
    
    .feature-desc {
      color: var(--text-light);
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    /* LEARN & FORMS PAGES */
    .learn-page, .forms-page {
      padding: 4rem 2rem;
      max-width: 900px;
      margin: 0 auto;
    }
    
    .page-header {
      margin-bottom: 3rem;
    }
    
    .page-tag {
      color: var(--accent);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
    }
    
    .page-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--ink);
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
    }
    
    .page-desc {
      color: var(--text-light);
      font-size: 1.1rem;
      line-height: 1.7;
    }
    
    .placeholder-card {
      background: var(--paper-warm);
      border: 2px dashed rgba(0,0,0,0.15);
      padding: 4rem 2rem;
      text-align: center;
    }
    
    .placeholder-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    .placeholder-text {
      color: var(--text-light);
      font-size: 1.1rem;
    }
    
    /* TABS */
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid rgba(0,0,0,0.08);
      padding-bottom: 0.5rem;
    }
    
    .tab {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-light);
      transition: all 0.2s;
      font-family: inherit;
      position: relative;
    }
    
    .tab:hover {
      color: var(--ink);
    }
    
    .tab.active {
      color: var(--accent);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -0.6rem;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
    }
    
    .form-card {
      background: var(--paper);
      border: 1px solid rgba(0,0,0,0.08);
      padding: 2.5rem;
      display: none;
    }
    
    .form-card.active {
      display: block;
    }
    
    .form-card-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--ink);
      margin-bottom: 1rem;
    }
    
    .form-card-desc {
      color: var(--text-light);
      margin-bottom: 2rem;
      font-size: 1.05rem;
      line-height: 1.7;
    }
    
    .info-box {
      padding: 1.25rem 1.5rem;
      margin-bottom: 2rem;
      border-left: 4px solid;
    }
    
    .info-box.blue {
      background: #eef4f8;
      border-color: #4a90a4;
    }
    
    .info-box.green {
      background: #eef5ef;
      border-color: var(--sage);
    }
    
    .info-box.purple {
      background: #f3eef8;
      border-color: #7a5ba4;
    }
    
    .info-box.yellow {
      background: #fdf8ed;
      border-color: var(--gold);
    }
    
    .info-box-title {
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 0.5rem;
    }
    
    .info-box-text {
      color: var(--text);
      font-size: 0.95rem;
    }
    
    .section-title {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--ink);
    }
    
    .pattern-box {
      background: var(--paper-warm);
      padding: 1.5rem;
      text-align: center;
      font-size: 1.25rem;
      margin-bottom: 2rem;
    }
    
    .conj-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-bottom: 2rem;
    }
    
    .conj-table th,
    .conj-table td {
      border: 1px solid rgba(0,0,0,0.1);
      padding: 0.75rem 1rem;
      text-align: left;
    }
    
    .conj-table th {
      background: var(--ink);
      color: var(--paper);
      font-weight: 600;
    }
    
    .conj-table tr:nth-child(even) {
      background: var(--paper-warm);
    }
    
    .conj-table .highlight {
      font-weight: 600;
      color: var(--accent);
    }
    
    .row-a { color: #c45c4a; font-weight: 600; }
    .row-i { color: #7a9e7e; font-weight: 600; }
    .row-u { color: #4a90a4; font-weight: 600; }
    .row-e { color: #7a5ba4; font-weight: 600; }
    .row-o { color: #c9a962; font-weight: 600; }
    
    .forms-cta {
      margin-top: 3rem;
      text-align: center;
    }
    
    /* CONJUGATOR PAGE */
    .conjugator-page {
      padding: 4rem 2rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .conjugator-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    
    .score-box {
      text-align: right;
    }
    
    .score-label {
      font-size: 0.8rem;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    .score-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--sage);
    }
    
    .form-select {
      width: 100%;
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 2px solid rgba(0,0,0,0.1);
      background: var(--paper);
      font-family: inherit;
      cursor: pointer;
      margin-bottom: 1.5rem;
      transition: border-color 0.2s;
    }
    
    .form-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .verb-display {
      background: var(--ink);
      padding: 2.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .verb-type {
      color: var(--accent-soft);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
    }
    
    .verb-kanji {
      font-size: 3.5rem;
      color: var(--paper);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    
    .verb-info {
      color: rgba(255,255,255,0.6);
      font-size: 1.15rem;
    }
    
    .prompt-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
      gap: 1rem;
    }
    
    .prompt-text {
      font-weight: 500;
      color: var(--ink);
      flex: 1;
    }
    
    .prompt-form {
      color: var(--accent);
      font-weight: 600;
      display: block;
      font-size: 1.05rem;
      margin-top: 0.25rem;
      line-height: 1.4;
    }
    
    .hint-btn {
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      font-family: inherit;
      white-space: nowrap;
      flex-shrink: 0;
      padding: 0.25rem 0.5rem;
    }
    
    .hint-btn:hover {
      color: var(--accent);
    }
    
    .hint-box {
      background: #fdf8ed;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      color: var(--text);
      display: none;
    }
    
    .hint-box.visible {
      display: block;
    }
    
    .answer-input {
      width: 100%;
      padding: 1.25rem;
      font-size: 1.35rem;
      border: 2px solid rgba(0,0,0,0.1);
      background: var(--paper);
      font-family: 'Noto Serif JP', serif;
      text-align: center;
      margin-bottom: 1rem;
      transition: all 0.2s;
    }
    
    .answer-input:focus {
      outline: none;
      border-color: var(--ink);
    }
    
    .answer-input:disabled {
      background: var(--paper-warm);
    }
    
    .feedback {
      padding: 1.25rem;
      margin-bottom: 1rem;
      text-align: center;
      display: none;
    }
    
    .feedback.visible {
      display: block;
    }
    
    .feedback.warning {
      background: #fef3e6;
      border: 2px solid #e6a756;
    }
    
    .feedback.correct {
      background: #eef5ef;
      border: 2px solid var(--sage);
    }
    
    .feedback.incorrect {
      background: #fbeef0;
      border: 2px solid var(--accent);
    }
    
    .feedback-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .feedback-answer {
      font-size: 1.25rem;
    }
    
    .feedback-explanation {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(0,0,0,0.1);
      text-align: left;
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text);
      display: none;
    }
    
    .feedback-explanation strong {
      color: var(--accent);
    }
    
    .check-btn {
      width: 100%;
      padding: 1.125rem;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }
    
    .check-btn.primary {
      background: var(--ink);
      color: var(--paper);
    }
    
    .check-btn.primary:hover:not(:disabled) {
      background: var(--ink-light);
    }
    
    .check-btn.primary:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .check-btn.next {
      background: var(--sage);
      color: var(--paper);
      display: none;
    }
    
    .check-btn.next:hover {
      opacity: 0.9;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      .nav-inner {
        padding: 0 1rem;
      }
      .nav-links {
        gap: 1rem;
      }
      .nav-link {
        font-size: 0.85rem;
      }
      .hero-content {
        padding: 2rem 1rem;
      }
      .features {
        padding: 4rem 1rem;
      }
      .tabs {
        flex-wrap: wrap;
      }
      .tab {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>

  <!-- NAVIGATION -->
  <nav class="nav">
    <div class="nav-inner">
      <div class="logo" onclick="showPage('home')">
        <span class="logo-kanji jp">Ê¥ªÁî®</span>
        <span class="logo-text">Katsuy≈ç Academy</span>
      </div>
      <div class="nav-links">
        <button class="nav-link active" data-page="home" onclick="showPage('home')">Home</button>
        <button class="nav-link" data-page="learn" onclick="showPage('learn')">Learn</button>
        <button class="nav-link" data-page="forms" onclick="showPage('forms')">Forms</button>
        <button class="nav-link" data-page="conjugator" onclick="showPage('conjugator')">The Conjugator</button>
      </div>
    </div>
  </nav>

  <!-- HOME PAGE -->
  <div id="page-home" class="page active">
    <div class="home">
      <section class="hero">
        <div class="hero-content">
          <div class="hero-badge">Japanese Verb Mastery</div>
          <h1 class="hero-title">Katsuy≈ç Academy</h1>
          <p class="hero-subtitle jp">Ê¥ªÁî®„ÇíÂ≠¶„Å∂</p>
          <p class="hero-desc">
            Master Japanese verb conjugation through clear explanations, 
            comprehensive reference charts, and interactive practice.
          </p>
          <div class="hero-cta">
            <button class="btn btn-primary" onclick="showPage('learn')">Start Learning</button>
            <button class="btn btn-secondary" onclick="showPage('conjugator')">Practice Now</button>
          </div>
        </div>
      </section>
      
      <section class="features">
        <div class="features-inner">
          <div class="features-header">
            <h2 class="features-title">Everything You Need</h2>
            <p class="features-subtitle">A complete toolkit for mastering Japanese verb conjugation</p>
          </div>
          <div class="features-grid">
            <div class="feature-card" onclick="showPage('learn')">
              <div class="feature-icon">üìñ</div>
              <h3 class="feature-title">Understand the System</h3>
              <p class="feature-desc">
                Learn how Japanese conjugation actually works with clear, intuitive explanations.
              </p>
            </div>
            <div class="feature-card" onclick="showPage('forms')">
              <div class="feature-icon">üìã</div>
              <h3 class="feature-title">Reference Forms</h3>
              <p class="feature-desc">
                Quick access to all verb forms for Godan, Ichidan, and Suru verbs in one place.
              </p>
            </div>
            <div class="feature-card" onclick="showPage('conjugator')">
              <div class="feature-icon">üéØ</div>
              <h3 class="feature-title">The Conjugator</h3>
              <p class="feature-desc">
                Put your knowledge to the test with interactive drills and instant feedback.
              </p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- LEARN PAGE -->
  <div id="page-learn" class="page">
    <div class="learn-page">
      <div class="page-header">
        <div class="page-tag">Understanding Conjugation</div>
        <h1 class="page-title">How Japanese Verbs Work</h1>
        <p class="page-desc">
          A clear explanation of the Japanese verb conjugation system, 
          designed to make the patterns intuitive and memorable.
        </p>
      </div>
      
      <div class="placeholder-card">
        <div class="placeholder-icon">‚úèÔ∏è</div>
        <p class="placeholder-text">
          Content coming soon ‚Äî your conjugation explanation will go here!
        </p>
      </div>
    </div>
  </div>

  <!-- FORMS PAGE -->
  <div id="page-forms" class="page">
    <div class="forms-page">
      <div class="page-header">
        <div class="page-tag">Quick Reference</div>
        <h1 class="page-title">Verb Forms</h1>
        <p class="page-desc">
          Conjugation patterns for all three verb types at a glance.
        </p>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="godan" onclick="showTab('godan')">‰∫îÊÆµ Godan</button>
        <button class="tab" data-tab="ichidan" onclick="showTab('ichidan')">‰∏ÄÊÆµ Ichidan</button>
        <button class="tab" data-tab="suru" onclick="showTab('suru')">„Åô„Çã Suru</button>
      </div>

      <!-- GODAN -->
      <div id="tab-godan" class="form-card active">
        <h2 class="form-card-title jp">‰∫îÊÆµÂãïË©û ‚Äî Godan Verbs</h2>
        <p class="form-card-desc">
          Godan means "five steps" because these verbs conjugate across the <strong>5 vowel rows</strong> of the hiragana chart: „ÅÇ, „ÅÑ, „ÅÜ, „Åà, „Åä
        </p>

        <div class="info-box blue">
          <div class="info-box-title">How to Identify</div>
          <p class="info-box-text">
            Verbs that do NOT end in -eru or -iru sounds, plus some exceptions that do (like Ëµ∞„Çã, Â∏∞„Çã).
          </p>
        </div>

        <h3 class="section-title">The 5-Row Chart</h3>
        <table class="conj-table">
          <thead>
            <tr>
              <th>Row</th>
              <th>„Åè</th>
              <th>„Åô</th>
              <th>„Å§</th>
              <th>„ÇÄ</th>
              <th>„Çã</th>
              <th>„ÅÜ</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="row-a">„ÅÇ (A)</td>
              <td>„Åã</td><td>„Åï</td><td>„Åü</td><td>„Åæ</td><td>„Çâ</td><td>„Çè</td>
              <td>+ „Å™„ÅÑ (negative)</td>
            </tr>
            <tr>
              <td class="row-i">„ÅÑ (I)</td>
              <td>„Åç</td><td>„Åó</td><td>„Å°</td><td>„Åø</td><td>„Çä</td><td>„ÅÑ</td>
              <td>+ „Åæ„Åô, „Åü„ÅÑ</td>
            </tr>
            <tr>
              <td class="row-u">„ÅÜ (U)</td>
              <td>„Åè</td><td>„Åô</td><td>„Å§</td><td>„ÇÄ</td><td>„Çã</td><td>„ÅÜ</td>
              <td>Dictionary form</td>
            </tr>
            <tr>
              <td class="row-e">„Åà (E)</td>
              <td>„Åë</td><td>„Åõ</td><td>„Å¶</td><td>„ÇÅ</td><td>„Çå</td><td>„Åà</td>
              <td>+ „Çã (potential)</td>
            </tr>
            <tr>
              <td class="row-o">„Åä (O)</td>
              <td>„Åì</td><td>„Åù</td><td>„Å®</td><td>„ÇÇ</td><td>„Çç</td><td>„Åä</td>
              <td>+ „ÅÜ (volitional)</td>
            </tr>
          </tbody>
        </table>

        <div class="info-box yellow">
          <div class="info-box-title">‚ö†Ô∏è Past Tense (Special Rules)</div>
          <p class="info-box-text">
            <strong>„Åè ‚Üí „ÅÑ„Åü</strong> („ÅÑ„Åè ‚Üí „ÅÑ„Å£„Åü) &nbsp;‚Ä¢&nbsp; 
            <strong>„Åê ‚Üí „ÅÑ„Å†</strong> („Åä„Çà„Åê ‚Üí „Åä„Çà„ÅÑ„Å†) &nbsp;‚Ä¢&nbsp; 
            <strong>„Åô ‚Üí „Åó„Åü</strong> („ÅØ„Å™„Åô ‚Üí „ÅØ„Å™„Åó„Åü)<br>
            <strong>„Å§/„Çã/„ÅÜ ‚Üí „Å£„Åü</strong> („Åã„ÅÜ ‚Üí „Åã„Å£„Åü) &nbsp;‚Ä¢&nbsp; 
            <strong>„ÇÄ/„Å∂/„Å¨ ‚Üí „Çì„Å†</strong> („ÅÆ„ÇÄ ‚Üí „ÅÆ„Çì„Å†)
          </p>
        </div>
      </div>

      <!-- ICHIDAN -->
      <div id="tab-ichidan" class="form-card">
        <h2 class="form-card-title jp">‰∏ÄÊÆµÂãïË©û ‚Äî Ichidan Verbs</h2>
        <p class="form-card-desc">
          Ichidan means "one step" because the stem <strong>never changes</strong> ‚Äî just drop „Çã and add your ending!
        </p>

        <div class="info-box green">
          <div class="info-box-title">How to Identify</div>
          <p class="info-box-text">
            Usually end in <strong>-eru</strong> or <strong>-iru</strong> sounds (but watch for exceptions!)
          </p>
        </div>

        <h3 class="section-title">Simple Pattern</h3>
        <div class="pattern-box">
          <span style="color: var(--text-light)">Stem</span> + 
          <span style="color: var(--accent); text-decoration: line-through; margin: 0 0.5rem">„Çã</span> ‚Üí 
          <span style="color: var(--text-light); margin-left: 0.5rem">Stem</span> + 
          <span style="color: var(--sage); font-weight: 600; margin-left: 0.5rem">ending</span>
        </div>

        <table class="conj-table">
          <thead>
            <tr>
              <th>Form</th>
              <th>Ending</th>
              <th>Example (È£ü„Åπ„Çã)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Negative</td><td>„Å™„ÅÑ</td><td class="highlight jp">„Åü„Åπ„Å™„ÅÑ</td></tr>
            <tr><td>Polite</td><td>„Åæ„Åô</td><td class="highlight jp">„Åü„Åπ„Åæ„Åô</td></tr>
            <tr><td>Past</td><td>„Åü</td><td class="highlight jp">„Åü„Åπ„Åü</td></tr>
            <tr><td>Want to</td><td>„Åü„ÅÑ</td><td class="highlight jp">„Åü„Åπ„Åü„ÅÑ</td></tr>
            <tr><td>Potential</td><td>„Çâ„Çå„Çã</td><td class="highlight jp">„Åü„Åπ„Çâ„Çå„Çã</td></tr>
            <tr><td>Volitional</td><td>„Çà„ÅÜ</td><td class="highlight jp">„Åü„Åπ„Çà„ÅÜ</td></tr>
          </tbody>
        </table>
      </div>

      <!-- SURU -->
      <div id="tab-suru" class="form-card">
        <h2 class="form-card-title jp">„Åô„ÇãÂãïË©û ‚Äî Suru Verbs</h2>
        <p class="form-card-desc">
          Nouns become verbs when you add <strong>„Åô„Çã</strong>. This is one of two irregular verbs in Japanese!
        </p>

        <div class="info-box purple">
          <div class="info-box-title">Common Examples</div>
          <p class="info-box-text">
            ÂãâÂº∑ (study) + „Åô„Çã = ÂãâÂº∑„Åô„Çã (to study)<br>
            ‰ªï‰∫ã (work) + „Åô„Çã = ‰ªï‰∫ã„Åô„Çã (to work)
          </p>
        </div>

        <h3 class="section-title">Conjugation Pattern</h3>
        <table class="conj-table">
          <thead>
            <tr>
              <th>Form</th>
              <th>„Åô„Çã becomes</th>
              <th>Example (ÂãâÂº∑„Åô„Çã)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Negative</td><td>„Åó„Å™„ÅÑ</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Å™„ÅÑ</td></tr>
            <tr><td>Polite</td><td>„Åó„Åæ„Åô</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åæ„Åô</td></tr>
            <tr><td>Past</td><td>„Åó„Åü</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åü</td></tr>
            <tr><td>Want to</td><td>„Åó„Åü„ÅÑ</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åü„ÅÑ</td></tr>
            <tr><td>Potential</td><td>„Åß„Åç„Çã</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åß„Åç„Çã</td></tr>
            <tr><td>Volitional</td><td>„Åó„Çà„ÅÜ</td><td class="highlight jp">„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Çà„ÅÜ</td></tr>
          </tbody>
        </table>
      </div>

      <div class="forms-cta">
        <button class="btn btn-primary" onclick="showPage('conjugator')">Practice with The Conjugator ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- CONJUGATOR PAGE -->
  <div id="page-conjugator" class="page">
    <div class="conjugator-page">
      <div class="conjugator-header">
        <div>
          <div class="page-tag">Interactive Practice</div>
          <h1 class="page-title" style="font-size: 2rem">The Conjugator</h1>
        </div>
        <div class="score-box">
          <div class="score-label">Score</div>
          <div class="score-value"><span id="score-correct">0</span> / <span id="score-total">0</span></div>
        </div>
      </div>

      <select id="form-select" class="form-select" onchange="generateNewQuestion()">
        <option value="random">üé≤ Random (All Forms)</option>
        <option value="negative">Negative („Å™„ÅÑ)</option>
        <option value="masu">Polite („Åæ„Åô)</option>
        <option value="past">Past („Åü)</option>
        <option value="tai">Want to („Åü„ÅÑ)</option>
        <option value="potential">Potential („Çâ„Çå„Çã/„Åà„Çã)</option>
        <option value="volitional">Volitional („Çà„ÅÜ/„Åä„ÅÜ)</option>
      </select>

      <div class="verb-display">
        <div id="verb-type" class="verb-type">Godan Verb</div>
        <div id="verb-kanji" class="verb-kanji jp">Ë°å„Åè</div>
        <div class="verb-info">
          <span id="verb-hiragana" class="jp">„ÅÑ„Åè</span> ‚Äî <span id="verb-meaning">to go</span>
        </div>
      </div>

      <div class="prompt-row">
        <span class="prompt-text">
          <span id="prompt-form" class="prompt-form">Negative</span>
        </span>
        <button class="hint-btn" onclick="toggleHint()">
          <span id="hint-btn-text">üí° Show hint</span>
        </button>
      </div>

      <div id="hint-box" class="hint-box">
        Hint: <span id="hint-text">„Å™„ÅÑ form</span>
      </div>

      <input 
        type="text"
        id="answer-input"
        class="answer-input jp"
        placeholder="„Å≤„Çâ„Åå„Å™„ÅßÂÖ•Âäõ..."
        onkeypress="handleKeyPress(event)"
      >

      <div id="feedback-warning" class="feedback warning">
        <div class="feedback-title">‚ö†Ô∏è Not quite ‚Äî try again!</div>
      </div>

      <div id="feedback-result" class="feedback">
        <div id="feedback-title" class="feedback-title"></div>
        <div class="feedback-answer jp">Answer: <strong id="feedback-answer"></strong></div>
        <div id="feedback-explanation" class="feedback-explanation"></div>
      </div>

      <button id="check-btn" class="check-btn primary" onclick="checkAnswer()" disabled>Check Answer</button>
      <button id="next-btn" class="check-btn next" onclick="generateNewQuestion()">Next Question ‚Üí</button>
    </div>
  </div>

  <script>
    // ============ DATA ============
    const verbs = {
      godan: [
        { kanji: 'Ë°å„Åè', hiragana: '„ÅÑ„Åè', romaji: 'iku', meaning: 'to go' },
        { kanji: 'Ë©±„Åô', hiragana: '„ÅØ„Å™„Åô', romaji: 'hanasu', meaning: 'to speak' },
        { kanji: 'Ë≤∑„ÅÜ', hiragana: '„Åã„ÅÜ', romaji: 'kau', meaning: 'to buy' },
        { kanji: 'ËÅû„Åè', hiragana: '„Åç„Åè', romaji: 'kiku', meaning: 'to listen' },
        { kanji: 'È£≤„ÇÄ', hiragana: '„ÅÆ„ÇÄ', romaji: 'nomu', meaning: 'to drink' },
        { kanji: 'Ê≠©„Åè', hiragana: '„ÅÇ„Çã„Åè', romaji: 'aruku', meaning: 'to walk' },
        { kanji: 'Ê≥£„Åè', hiragana: '„Å™„Åè', romaji: 'naku', meaning: 'to cry' },
        { kanji: 'ÁµÇ„Çè„Çã', hiragana: '„Åä„Çè„Çã', romaji: 'owaru', meaning: 'to end' },
        { kanji: 'Ê≠å„ÅÜ', hiragana: '„ÅÜ„Åü„ÅÜ', romaji: 'utau', meaning: 'to sing' },
        { kanji: 'Ëµ∞„Çã', hiragana: '„ÅØ„Åó„Çã', romaji: 'hashiru', meaning: 'to run' }
      ],
      ichidan: [
        { kanji: 'È£ü„Åπ„Çã', hiragana: '„Åü„Åπ„Çã', romaji: 'taberu', meaning: 'to eat' },
        { kanji: 'Ë¶ã„Çã', hiragana: '„Åø„Çã', romaji: 'miru', meaning: 'to see' },
        { kanji: 'ÂØù„Çã', hiragana: '„Å≠„Çã', romaji: 'neru', meaning: 'to sleep' },
        { kanji: 'Ëµ∑„Åç„Çã', hiragana: '„Åä„Åç„Çã', romaji: 'okiru', meaning: 'to wake up' },
        { kanji: 'Èñã„Åë„Çã', hiragana: '„ÅÇ„Åë„Çã', romaji: 'akeru', meaning: 'to open' }
      ],
      suru: [
        { kanji: '„Åô„Çã', hiragana: '„Åô„Çã', romaji: 'suru', meaning: 'to do' },
        { kanji: 'ÂãâÂº∑„Åô„Çã', hiragana: '„Åπ„Çì„Åç„Çá„ÅÜ„Åô„Çã', romaji: 'benkyou suru', meaning: 'to study' },
        { kanji: '‰ªï‰∫ã„Åô„Çã', hiragana: '„Åó„Åî„Å®„Åô„Çã', romaji: 'shigoto suru', meaning: 'to work' },
        { kanji: 'ÊñôÁêÜ„Åô„Çã', hiragana: '„Çä„Çá„ÅÜ„Çä„Åô„Çã', romaji: 'ryouri suru', meaning: 'to cook' }
      ]
    };

    const forms = [
      { 
        name: 'Negative', 
        key: 'negative', 
        hint: 'Think about what sound you need for negation. Which row of the hiragana chart will give you the right stem before adding the negative ending?',
        templates: [
          { text: 'Conjugate to: Negative', type: 'direct' },
          { text: 'How would you say "{meaning} (negative)"?', type: 'phrase' },
          { text: 'Express the idea: "does not {meaning}"', type: 'phrase' }
        ]
      },
      { 
        name: 'Masu', 
        key: 'masu', 
        hint: 'For polite speech, you need a stem that ends in an „ÅÑ sound. Think about how the verb ending needs to change before adding the polite marker.',
        templates: [
          { text: 'Conjugate to: Polite (Masu)', type: 'direct' },
          { text: 'How would you say "{meaning}" politely?', type: 'phrase' },
          { text: 'Make this verb into its polite form', type: 'phrase' }
        ]
      },
      { 
        name: 'Past', 
        key: 'past', 
        hint: 'Past tense has different patterns depending on verb type. Consider what the final sound of the verb is‚Äîthat determines which past ending pattern to use.',
        templates: [
          { text: 'Conjugate to: Past', type: 'direct' },
          { text: 'How would you say "{meaning} (past tense)"?', type: 'phrase' },
          { text: 'Express: "I {meaning} already"', type: 'phrase' }
        ]
      },
      { 
        name: 'Tai', 
        key: 'tai', 
        hint: 'When expressing "want to do," you need the same stem as the polite form. What sound should come before „Åü„ÅÑ?',
        templates: [
          { text: 'Conjugate to: Want to (Tai)', type: 'direct' },
          { text: 'How would you say "I want to {meaning}"?', type: 'phrase' },
          { text: 'Express desire: "want to {meaning}"', type: 'phrase' }
        ]
      },
      { 
        name: 'Potential', 
        key: 'potential', 
        hint: 'The potential form shows ability. Think about which sound before „Çã will express "can do." Consider the verb type carefully‚Äîeach has its own pattern.',
        templates: [
          { text: 'Conjugate to: Potential', type: 'direct' },
          { text: 'How would you say "can {meaning}"?', type: 'phrase' },
          { text: 'Express ability: "able to {meaning}"', type: 'phrase' }
        ]
      },
      { 
        name: 'Volitional', 
        key: 'volitional', 
        hint: 'To suggest doing something together, you need a stem with an „Åä sound for some verbs. What makes sense for this verb type?',
        templates: [
          { text: 'Conjugate to: Volitional', type: 'direct' },
          { text: 'How would you say "let\'s {meaning}"?', type: 'phrase' },
          { text: 'Suggest together: "let\'s {meaning}"', type: 'phrase' }
        ]
      }
    ];

    // ============ STATE ============
    let currentVerb = null;
    let currentForm = null;
    let currentPrompt = null; // Track which prompt template we're using
    let showAnswer = false;
    let firstAttempt = true;
    let stats = { correct: 0, total: 0 };
    let hintVisible = false;
    let failureTracking = {}; // Track consecutive failures by form type: { 'godan-negative': 2, ... }
    let isTypeIdentificationQuiz = false; // Are we in verb type ID mode?
    let typeIdentificationAnswer = null; // What type did they guess?
    let recentlyUsedVerbs = []; // Track recently used verbs to avoid repetition
    const MAX_RECENT_VERBS = 12; // Keep last 12 verbs in memory

    // ============ NAVIGATION ============
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page-' + pageName).classList.add('active');
      
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.querySelector('.nav-link[data-page="' + pageName + '"]').classList.add('active');
      
      // Only generate a new question if we don't have one yet
      if (pageName === 'conjugator' && !currentVerb) {
        generateNewQuestion();
      }
    }

    function showTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.tab[data-tab="' + tabName + '"]').classList.add('active');
      
      document.querySelectorAll('.form-card').forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
    }

    // ============ CONJUGATOR LOGIC ============
    
    // Normalize and check verb type answer (accepts multiple formats)
    function checkVerbType(userInput, correctType) {
      const normalized = userInput.toLowerCase().trim();
      
      // Define all acceptable answers for each type
      const acceptableAnswers = {
        godan: ['godan', '„Åî„Å†„Çì', '‰∫îÊÆµ', 'god–∞–Ω', 'u-verb', 'group 1', 'group1', 'type 1', 'type1'],
        ichidan: ['ichidan', '„ÅÑ„Å°„Å†„Çì', '‰∏ÄÊÆµ', 'ru-verb', 'group 2', 'group2', 'type 2', 'type2'],
        suru: ['suru', '„Åô„Çã', '„Åô„ÇãÂãïË©û', 'group 3', 'group3', 'type 3', 'type3', 'irregular']
      };
      
      // Check if the user's answer matches any acceptable answer for the correct type
      return acceptableAnswers[correctType].some(answer => 
        normalized === answer || normalized.includes(answer)
      );
    }
    
    // Generate a step-by-step walkthrough for the current verb
    function generateWorkedExample(verb, form) {
      let steps = [];
      const correctAnswer = conjugateVerb(verb, form);
      
      if (verb.type === 'godan') {
        const lastChar = verb.hiragana.slice(-1);
        const stem = verb.hiragana.slice(0, -1);
        
        steps.push(`<strong>Step 1:</strong> Identify the verb type. ${verb.kanji} (${verb.hiragana}) is a <strong>godan verb</strong> because it ends in "${lastChar}".`);
        
        if (form.key === 'negative') {
          const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
          const a = ['„Åã', '„Åå', '„Åï', '„Åü', '„Å™', '„Å∞', '„Åæ', '„Çâ', '„Çè'];
          const idx = u.indexOf(lastChar);
          const aRow = a[idx];
          steps.push(`<strong>Step 2:</strong> For negative form, shift "${lastChar}" to the „ÅÇ-row: "${lastChar}" ‚Üí "${aRow}".`);
          steps.push(`<strong>Step 3:</strong> Add „Å™„ÅÑ: ${stem}${aRow} + „Å™„ÅÑ = <strong class="jp">${correctAnswer}</strong>`);
        } else if (form.key === 'masu') {
          const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
          const i = ['„Åç', '„Åé', '„Åó', '„Å°', '„Å´', '„Å≥', '„Åø', '„Çä', '„ÅÑ'];
          const idx = u.indexOf(lastChar);
          const iRow = i[idx];
          steps.push(`<strong>Step 2:</strong> For masu form, shift "${lastChar}" to the „ÅÑ-row: "${lastChar}" ‚Üí "${iRow}".`);
          steps.push(`<strong>Step 3:</strong> Add „Åæ„Åô: ${stem}${iRow} + „Åæ„Åô = <strong class="jp">${correctAnswer}</strong>`);
        } else if (form.key === 'past') {
          steps.push(`<strong>Step 2:</strong> For past tense, godan verbs have special sound changes.`);
          if (lastChar === '„Åè') {
            steps.push(`<strong>Step 3:</strong> "${lastChar}" becomes "„ÅÑ„Åü": ${stem} + „ÅÑ„Åü = <strong class="jp">${correctAnswer}</strong>`);
          } else if (lastChar === '„Åê') {
            steps.push(`<strong>Step 3:</strong> "${lastChar}" becomes "„ÅÑ„Å†": ${stem} + „ÅÑ„Å† = <strong class="jp">${correctAnswer}</strong>`);
          } else if (lastChar === '„Åô') {
            steps.push(`<strong>Step 3:</strong> "${lastChar}" becomes "„Åó„Åü": ${stem} + „Åó„Åü = <strong class="jp">${correctAnswer}</strong>`);
          } else if (['„Å§', '„Çã', '„ÅÜ'].includes(lastChar)) {
            steps.push(`<strong>Step 3:</strong> "${lastChar}" becomes "„Å£„Åü": ${stem} + „Å£„Åü = <strong class="jp">${correctAnswer}</strong>`);
          } else if (['„ÇÄ', '„Å∂', '„Å¨'].includes(lastChar)) {
            steps.push(`<strong>Step 3:</strong> "${lastChar}" becomes "„Çì„Å†": ${stem} + „Çì„Å† = <strong class="jp">${correctAnswer}</strong>`);
          }
        } else if (form.key === 'tai') {
          const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
          const i = ['„Åç', '„Åé', '„Åó', '„Å°', '„Å´', '„Å≥', '„Åø', '„Çä', '„ÅÑ'];
          const idx = u.indexOf(lastChar);
          const iRow = i[idx];
          steps.push(`<strong>Step 2:</strong> For „Åü„ÅÑ form, shift "${lastChar}" to the „ÅÑ-row: "${lastChar}" ‚Üí "${iRow}".`);
          steps.push(`<strong>Step 3:</strong> Add „Åü„ÅÑ: ${stem}${iRow} + „Åü„ÅÑ = <strong class="jp">${correctAnswer}</strong>`);
        } else if (form.key === 'potential') {
          const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
          const e = ['„Åë', '„Åí', '„Åõ', '„Å¶', '„Å≠', '„Åπ', '„ÇÅ', '„Çå', '„Åà'];
          const idx = u.indexOf(lastChar);
          const eRow = e[idx];
          steps.push(`<strong>Step 2:</strong> For potential form, shift "${lastChar}" to the „Åà-row: "${lastChar}" ‚Üí "${eRow}".`);
          steps.push(`<strong>Step 3:</strong> Add „Çã: ${stem}${eRow} + „Çã = <strong class="jp">${correctAnswer}</strong>`);
        } else if (form.key === 'volitional') {
          const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
          const o = ['„Åì', '„Åî', '„Åù', '„Å®', '„ÅÆ', '„Åº', '„ÇÇ', '„Çç', '„Åä'];
          const idx = u.indexOf(lastChar);
          const oRow = o[idx];
          steps.push(`<strong>Step 2:</strong> For volitional form, shift "${lastChar}" to the „Åä-row: "${lastChar}" ‚Üí "${oRow}".`);
          steps.push(`<strong>Step 3:</strong> Add „ÅÜ: ${stem}${oRow} + „ÅÜ = <strong class="jp">${correctAnswer}</strong>`);
        }
      } else if (verb.type === 'ichidan') {
        const stem = verb.hiragana.slice(0, -1);
        steps.push(`<strong>Step 1:</strong> Identify the verb type. ${verb.kanji} (${verb.hiragana}) is an <strong>ichidan verb</strong>‚Äîit ends in -eru or -iru sound.`);
        steps.push(`<strong>Step 2:</strong> For ichidan verbs, the stem never changes. Drop the „Çã: ${verb.hiragana} ‚Üí ${stem}`);
        
        const endings = {
          negative: '„Å™„ÅÑ',
          masu: '„Åæ„Åô',
          past: '„Åü',
          tai: '„Åü„ÅÑ',
          potential: '„Çâ„Çå„Çã',
          volitional: '„Çà„ÅÜ'
        };
        
        steps.push(`<strong>Step 3:</strong> Add ${endings[form.key]}: ${stem} + ${endings[form.key]} = <strong class="jp">${correctAnswer}</strong>`);
      } else if (verb.type === 'suru') {
        const prefix = verb.hiragana.replace('„Åô„Çã', '');
        steps.push(`<strong>Step 1:</strong> Identify the verb type. ${verb.kanji} (${verb.hiragana}) is a <strong>suru verb</strong>‚Äîit's formed by adding „Åô„Çã to a noun.`);
        
        const suruMap = {
          negative: '„Åó„Å™„ÅÑ',
          masu: '„Åó„Åæ„Åô',
          past: '„Åó„Åü',
          tai: '„Åó„Åü„ÅÑ',
          potential: '„Åß„Åç„Çã',
          volitional: '„Åó„Çà„ÅÜ'
        };
        
        if (form.key === 'potential') {
          steps.push(`<strong>Step 2:</strong> For potential form, „Åô„Çã becomes „Åß„Åç„Çã (special case).`);
          steps.push(`<strong>Step 3:</strong> Replace „Åô„Çã with „Åß„Åç„Çã: ${prefix}„Åô„Çã ‚Üí <strong class="jp">${correctAnswer}</strong>`);
        } else {
          steps.push(`<strong>Step 2:</strong> For ${form.name} form, „Åô„Çã becomes ${suruMap[form.key]}.`);
          steps.push(`<strong>Step 3:</strong> Replace „Åô„Çã with ${suruMap[form.key]}: ${prefix}„Åô„Çã ‚Üí <strong class="jp">${correctAnswer}</strong>`);
        }
      }
      
      return '<div style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.03); border-radius: 4px; text-align: left;">' +
             '<div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--sage);">Let\'s work through this together:</div>' +
             steps.map(s => `<div style="margin-bottom: 0.5rem; line-height: 1.6;">${s}</div>`).join('') +
             '</div>';
    }
    
    // Check if the answer is close enough to warrant a retry
    function isAnswerInBallpark(userAnswer, correctAnswer) {
      // Remove spaces for comparison
      const user = userAnswer.trim();
      const correct = correctAnswer.trim();
      
      // If completely empty, not in ballpark
      if (!user) return false;
      
      // Check if it's all hiragana (basic validation)
      const hiraganaRegex = /^[„ÅÅ-„Çì]+$/;
      if (!hiraganaRegex.test(user)) {
        return false; // Contains non-hiragana, probably way off
      }
      
      // Check length similarity (within 3 characters)
      if (Math.abs(user.length - correct.length) > 3) {
        return false;
      }
      
      // Check for any character overlap
      let overlapCount = 0;
      for (let char of user) {
        if (correct.includes(char)) overlapCount++;
      }
      
      // If at least 40% of characters are in the correct answer, it's close
      return (overlapCount / user.length) >= 0.4;
    }
    
    // Generate detailed error explanation
    function getErrorExplanation(userAnswer, correctAnswer, verb, form) {
      const user = userAnswer.trim();
      
      // Check for non-hiragana
      const hiraganaRegex = /^[„ÅÅ-„Çì]+$/;
      if (!hiraganaRegex.test(user)) {
        return "Your answer contains characters that aren't hiragana. Remember, we're conjugating the verb, not translating it. Write your answer in hiragana only.";
      }
      
      // Check if they forgot to conjugate
      if (user === verb.hiragana) {
        return `You entered the dictionary form (${verb.hiragana}), but we need the <strong>${form.name}</strong> form. You need to change the verb ending.`;
      }
      
      // Type-specific hints
      if (verb.type === 'godan') {
        const lastChar = verb.hiragana.slice(-1);
        const userLast = user.slice(-1);
        
        if (form.key === 'negative' && !user.endsWith('„Å™„ÅÑ')) {
          return `For godan negative, you need to end with <strong>„Å™„ÅÑ</strong>. The last character of ${verb.hiragana} (${lastChar}) should shift to the „ÅÇ-row, then add „Å™„ÅÑ.`;
        }
        
        if (form.key === 'masu' && !user.endsWith('„Åæ„Åô')) {
          return `For godan polite form, you need to end with <strong>„Åæ„Åô</strong>. Shift ${lastChar} to the „ÅÑ-row, then add „Åæ„Åô.`;
        }
        
        if (form.key === 'past' && !user.endsWith('„Åü') && !user.endsWith('„Å†')) {
          return `For godan past tense, you need special endings like <strong>„ÅÑ„Åü, „ÅÑ„Å†, „Åó„Åü, „Å£„Åü, or „Çì„Å†</strong> depending on the verb ending. Check which pattern ${verb.hiragana} follows.`;
        }
        
        if (form.key === 'tai' && !user.endsWith('„Åü„ÅÑ')) {
          return `For the „Åü„ÅÑ form, shift to the „ÅÑ-row and add <strong>„Åü„ÅÑ</strong>. Your answer should end with „Åü„ÅÑ.`;
        }
        
        if (form.key === 'potential' && !user.endsWith('„Çã')) {
          return `For godan potential, shift to the „Åà-row and add <strong>„Çã</strong>. Your answer should end with „Çã.`;
        }
        
        if (form.key === 'volitional' && !user.endsWith('„ÅÜ')) {
          return `For godan volitional, shift to the „Åä-row and add <strong>„ÅÜ</strong>. Your answer should end with „ÅÜ.`;
        }
        
        return `Remember, this is a <strong>godan verb</strong> that conjugates by shifting the final kana to different rows („ÅÇ„ÄÅ„ÅÑ„ÄÅ„ÅÜ„ÄÅ„Åà„ÄÅ„Åä). Check your conjugation pattern for the ${form.name} form.`;
      }
      
      if (verb.type === 'ichidan') {
        const stem = verb.hiragana.slice(0, -1);
        
        if (!user.startsWith(stem)) {
          return `For ichidan verbs, the stem <strong>never changes</strong>. Your answer should start with "${stem}". Just drop the „Çã and add the correct ending.`;
        }
        
        if (form.key === 'negative' && !user.endsWith('„Å™„ÅÑ')) {
          return `For ichidan negative: drop „Çã and add <strong>„Å™„ÅÑ</strong>. It should be ${stem}„Å™„ÅÑ.`;
        }
        
        if (form.key === 'masu' && !user.endsWith('„Åæ„Åô')) {
          return `For ichidan polite: drop „Çã and add <strong>„Åæ„Åô</strong>. It should be ${stem}„Åæ„Åô.`;
        }
        
        if (form.key === 'past' && !user.endsWith('„Åü')) {
          return `For ichidan past: drop „Çã and add <strong>„Åü</strong>. It should be ${stem}„Åü.`;
        }
        
        if (form.key === 'tai' && !user.endsWith('„Åü„ÅÑ')) {
          return `For ichidan desire form: drop „Çã and add <strong>„Åü„ÅÑ</strong>. It should be ${stem}„Åü„ÅÑ.`;
        }
        
        if (form.key === 'potential' && !user.endsWith('„Çâ„Çå„Çã')) {
          return `For ichidan potential: drop „Çã and add <strong>„Çâ„Çå„Çã</strong>. It should be ${stem}„Çâ„Çå„Çã.`;
        }
        
        if (form.key === 'volitional' && !user.endsWith('„Çà„ÅÜ')) {
          return `For ichidan volitional: drop „Çã and add <strong>„Çà„ÅÜ</strong>. It should be ${stem}„Çà„ÅÜ.`;
        }
        
        return `Remember, this is an <strong>ichidan verb</strong>. The stem never changes‚Äîjust drop „Çã and add the ending for the ${form.name} form.`;
      }
      
      if (verb.type === 'suru') {
        const suruMap = { 
          negative: '„Åó„Å™„ÅÑ', 
          masu: '„Åó„Åæ„Åô', 
          past: '„Åó„Åü', 
          tai: '„Åó„Åü„ÅÑ', 
          potential: '„Åß„Åç„Çã', 
          volitional: '„Åó„Çà„ÅÜ' 
        };
        
        const expectedEnding = suruMap[form.key];
        const prefix = verb.hiragana.replace('„Åô„Çã', '');
        
        if (form.key === 'potential') {
          return `For „Åô„Çã verbs in potential form, „Åô„Çã becomes <strong>„Åß„Åç„Çã</strong>. The answer should be ${prefix}„Åß„Åç„Çã.`;
        }
        
        return `For „Åô„Çã verbs, replace „Åô„Çã with <strong>${expectedEnding}</strong>. The answer should be ${prefix}${expectedEnding}.`;
      }
      
      return `Your answer doesn't match the correct conjugation pattern. Review how ${verb.type} verbs conjugate in the ${form.name} form.`;
    }
    
    function getRandomVerb() {
      const types = ['godan', 'ichidan', 'suru'];
      const weights = [5, 3, 2];
      const weightedTypes = types.flatMap((type, i) => Array(weights[i]).fill(type));
      const type = weightedTypes[Math.floor(Math.random() * weightedTypes.length)];
      const verbList = verbs[type];
      
      // Try to pick a verb that hasn't been used recently
      let availableVerbs = verbList.filter(v => 
        !recentlyUsedVerbs.some(recent => 
          recent.kanji === v.kanji && recent.type === type
        )
      );
      
      // If all verbs have been used recently, use the full list
      if (availableVerbs.length === 0) {
        availableVerbs = verbList;
      }
      
      const verb = availableVerbs[Math.floor(Math.random() * availableVerbs.length)];
      
      const selectedForm = document.getElementById('form-select').value;
      let form = selectedForm === 'random' 
        ? forms[Math.floor(Math.random() * forms.length)] 
        : forms.find(f => f.key === selectedForm);
      
      // Pick a random prompt template
      const template = form.templates[Math.floor(Math.random() * form.templates.length)];
      
      // Add to recently used list
      const verbWithType = { ...verb, type };
      recentlyUsedVerbs.push(verbWithType);
      
      // Keep only the last MAX_RECENT_VERBS
      if (recentlyUsedVerbs.length > MAX_RECENT_VERBS) {
        recentlyUsedVerbs.shift();
      }
      
      return { ...verb, type, form, template };
    }

    function conjugateVerb(verb, form) {
      if (!verb) return '';
      const stem = verb.hiragana.slice(0, -1);
      const last = verb.hiragana.slice(-1);
      
      if (verb.type === 'suru') {
        const map = { negative: '„Åó„Å™„ÅÑ', masu: '„Åó„Åæ„Åô', past: '„Åó„Åü', tai: '„Åó„Åü„ÅÑ', potential: '„Åß„Åç„Çã', volitional: '„Åó„Çà„ÅÜ' };
        return verb.hiragana.replace('„Åô„Çã', map[form.key]);
      } else if (verb.type === 'godan') {
        const u = ['„Åè', '„Åê', '„Åô', '„Å§', '„Å¨', '„Å∂', '„ÇÄ', '„Çã', '„ÅÜ'];
        const a = ['„Åã', '„Åå', '„Åï', '„Åü', '„Å™', '„Å∞', '„Åæ', '„Çâ', '„Çè'];
        const i = ['„Åç', '„Åé', '„Åó', '„Å°', '„Å´', '„Å≥', '„Åø', '„Çä', '„ÅÑ'];
        const e = ['„Åë', '„Åí', '„Åõ', '„Å¶', '„Å≠', '„Åπ', '„ÇÅ', '„Çå', '„Åà'];
        const o = ['„Åì', '„Åî', '„Åù', '„Å®', '„ÅÆ', '„Åº', '„ÇÇ', '„Çç', '„Åä'];
        const idx = u.indexOf(last);
        
        if (form.key === 'negative') return stem + a[idx] + '„Å™„ÅÑ';
        if (form.key === 'masu') return stem + i[idx] + '„Åæ„Åô';
        if (form.key === 'tai') return stem + i[idx] + '„Åü„ÅÑ';
        if (form.key === 'potential') return stem + e[idx] + '„Çã';
        if (form.key === 'volitional') return stem + o[idx] + '„ÅÜ';
        if (form.key === 'past') {
          if (last === '„Åè') return stem + '„ÅÑ„Åü';
          if (last === '„Åê') return stem + '„ÅÑ„Å†';
          if (last === '„Åô') return stem + '„Åó„Åü';
          if (['„Å§', '„Çã', '„ÅÜ'].includes(last)) return stem + '„Å£„Åü';
          if (['„ÇÄ', '„Å∂', '„Å¨'].includes(last)) return stem + '„Çì„Å†';
        }
      } else {
        const map = { negative: '„Å™„ÅÑ', masu: '„Åæ„Åô', past: '„Åü', tai: '„Åü„ÅÑ', potential: '„Çâ„Çå„Çã', volitional: '„Çà„ÅÜ' };
        return stem + map[form.key];
      }
      return verb.hiragana;
    }

    function generateNewQuestion() {
      currentVerb = getRandomVerb();
      currentPrompt = currentVerb.template;
      showAnswer = false;
      firstAttempt = true;
      hintVisible = false;
      typeIdentificationAnswer = null;
      
      // 25% chance to do verb type identification quiz
      isTypeIdentificationQuiz = Math.random() < 0.25;
      
      if (isTypeIdentificationQuiz) {
        // Hide verb type, ask them to identify it
        document.getElementById('verb-type').style.display = 'none';
        document.getElementById('prompt-form').innerHTML = 'What type of verb is this?<br><span style="font-size: 0.85rem; font-weight: 400; color: var(--text-light); margin-top: 0.5rem; display: block; line-height: 1.8;">Enter: <strong>godan</strong> / „Åî„Å†„Çì / ‰∫îÊÆµ<br>or <strong>ichidan</strong> / „ÅÑ„Å°„Å†„Çì / ‰∏ÄÊÆµ<br>or <strong>suru</strong> / „Åô„Çã</span>';
        document.getElementById('hint-text').textContent = 'Look at how the verb ends. Does it follow the pattern for godan („ÅÜ-sound endings), ichidan (-eru/-iru), or suru („Åô„Çã)?';
      } else {
        // Normal conjugation mode
        document.getElementById('verb-type').style.display = 'block';
        document.getElementById('verb-type').textContent = 
          currentVerb.type === 'godan' ? 'Godan Verb' : 
          currentVerb.type === 'ichidan' ? 'Ichidan Verb' : 'Suru Verb';
        
        // Generate the prompt text with replacements
        let promptText = currentPrompt.text.replace('{meaning}', currentVerb.meaning.replace('to ', ''));
        document.getElementById('prompt-form').innerHTML = promptText;
        document.getElementById('hint-text').textContent = currentVerb.form.hint;
      }
      
      // Update display
      document.getElementById('verb-kanji').textContent = currentVerb.kanji;
      document.getElementById('verb-hiragana').textContent = currentVerb.hiragana;
      document.getElementById('verb-meaning').textContent = currentVerb.meaning;
      
      // Reset UI
      document.getElementById('answer-input').value = '';
      document.getElementById('answer-input').disabled = false;
      document.getElementById('hint-box').classList.remove('visible');
      document.getElementById('hint-btn-text').textContent = 'üí° Show hint';
      document.getElementById('feedback-warning').classList.remove('visible');
      document.getElementById('feedback-result').classList.remove('visible', 'correct', 'incorrect');
      document.getElementById('check-btn').style.display = 'block';
      document.getElementById('check-btn').disabled = true;
      document.getElementById('next-btn').style.display = 'none';
      
      document.getElementById('answer-input').focus();
    }

    function toggleHint() {
      hintVisible = !hintVisible;
      document.getElementById('hint-box').classList.toggle('visible', hintVisible);
      document.getElementById('hint-btn-text').textContent = hintVisible ? 'üôà Hide hint' : 'üí° Show hint';
    }

    function checkAnswer() {
      const userAnswer = document.getElementById('answer-input').value.trim();
      
      if (isTypeIdentificationQuiz) {
        // ===== VERB TYPE IDENTIFICATION MODE =====
        const correctType = currentVerb.type;
        const isCorrect = checkVerbType(userAnswer, correctType);
        
        if (isCorrect) {
          // Correct! Now ask them to conjugate
          typeIdentificationAnswer = correctType;
          isTypeIdentificationQuiz = false;
          
          // Show brief success message
          const feedbackResult = document.getElementById('feedback-result');
          feedbackResult.classList.add('visible', 'correct');
          document.getElementById('feedback-title').textContent = '‚úì Correct!';
          document.getElementById('feedback-answer').innerHTML = `This is a <strong>${correctType}</strong> verb.`;
          document.getElementById('feedback-explanation').innerHTML = 'Now conjugate this verb:';
          document.getElementById('feedback-explanation').style.display = 'block';
          
          // Update UI to conjugation mode (increased delay to 3 seconds)
          setTimeout(() => {
            document.getElementById('verb-type').style.display = 'block';
            document.getElementById('verb-type').textContent = 
              currentVerb.type === 'godan' ? 'Godan Verb' : 
              currentVerb.type === 'ichidan' ? 'Ichidan Verb' : 'Suru Verb';
            
            let promptText = currentPrompt.text.replace('{meaning}', currentVerb.meaning.replace('to ', ''));
            document.getElementById('prompt-form').innerHTML = promptText;
            document.getElementById('hint-text').textContent = currentVerb.form.hint;
            
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('feedback-result').classList.remove('visible');
            document.getElementById('check-btn').disabled = true;
            document.getElementById('answer-input').focus();
          }, 3000);
        } else {
          // Wrong type identification
          showAnswer = true;
          document.getElementById('answer-input').disabled = true;
          
          const feedbackResult = document.getElementById('feedback-result');
          feedbackResult.classList.add('visible', 'incorrect');
          document.getElementById('feedback-title').textContent = '‚úó Incorrect';
          document.getElementById('feedback-answer').innerHTML = `This is a <strong>${correctType}</strong> verb.`;
          
          // Generate detailed explanation
          let explanation = '';
          if (correctType === 'godan') {
            explanation = `<strong>Godan (‰∫îÊÆµ) verbs</strong> end in one of nine „ÅÜ-sound syllables: „Åè„ÄÅ„Åê„ÄÅ„Åô„ÄÅ„Å§„ÄÅ„Å¨„ÄÅ„Å∂„ÄÅ„ÇÄ„ÄÅ„Çã„ÄÅor „ÅÜ. ` +
                         `${currentVerb.kanji} ends in "${currentVerb.hiragana.slice(-1)}", which is one of these endings. ` +
                         `They're called "five-step" verbs because they conjugate by moving through the five vowel rows („ÅÇ„ÄÅ„ÅÑ„ÄÅ„ÅÜ„ÄÅ„Åà„ÄÅ„Åä). ` +
                         `<br><br><strong>Watch out:</strong> Some verbs ending in „Çã are godan, not ichidan (like Ëµ∞„Çã, Â∏∞„Çã, Áü•„Çã).`;
          } else if (correctType === 'ichidan') {
            explanation = `<strong>Ichidan (‰∏ÄÊÆµ) verbs</strong> typically end in -eru („Åà„Çã) or -iru („ÅÑ„Çã) sounds. ` +
                         `${currentVerb.kanji} (${currentVerb.hiragana}) follows this pattern. ` +
                         `They're called "one-step" verbs because the stem never changes‚Äîyou just drop „Çã and add endings. ` +
                         `<br><br><strong>Note:</strong> Not all verbs ending in -eru/-iru are ichidan (there are exceptions like Â∏∞„Çã„ÄÅËµ∞„Çã).`;
          } else {
            explanation = `<strong>Suru („Åô„Çã) verbs</strong> are formed by adding „Åô„Çã to a noun. ` +
                         `${currentVerb.kanji} is "${currentVerb.meaning}" = [noun] + „Åô„Çã. ` +
                         `These are irregular verbs with their own conjugation patterns. ` +
                         `Common examples: ÂãâÂº∑„Åô„Çã (to study), ‰ªï‰∫ã„Åô„Çã (to work), ÊñôÁêÜ„Åô„Çã (to cook).`;
          }
          
          document.getElementById('feedback-explanation').innerHTML = explanation;
          document.getElementById('feedback-explanation').style.display = 'block';
          
          document.getElementById('check-btn').style.display = 'none';
          document.getElementById('next-btn').style.display = 'block';
        }
        
        return;
      }
      
      // ===== NORMAL CONJUGATION MODE =====
      const correctAnswer = conjugateVerb(currentVerb, currentVerb.form);
      const isCorrect = userAnswer.toLowerCase() === correctAnswer;
      const failureKey = `${currentVerb.type}-${currentVerb.form.key}`;
      
      if (isCorrect) {
        // Correct answer!
        stats.total++;
        stats.correct++;
        document.getElementById('score-correct').textContent = stats.correct;
        document.getElementById('score-total').textContent = stats.total;
        
        // Reset failure tracking for this type-form combo
        failureTracking[failureKey] = 0;
        
        showAnswer = true;
        document.getElementById('answer-input').disabled = true;
        document.getElementById('feedback-warning').classList.remove('visible');
        
        const feedbackResult = document.getElementById('feedback-result');
        feedbackResult.classList.add('visible', 'correct');
        document.getElementById('feedback-title').textContent = '‚úì Correct!';
        document.getElementById('feedback-answer').textContent = correctAnswer;
        document.getElementById('feedback-explanation').innerHTML = '';
        document.getElementById('feedback-explanation').style.display = 'none';
        
        document.getElementById('check-btn').style.display = 'none';
        document.getElementById('next-btn').style.display = 'block';
      } else {
        // Wrong answer - check if it's in the ballpark
        const inBallpark = isAnswerInBallpark(userAnswer, correctAnswer);
        
        if (inBallpark && firstAttempt) {
          // Close enough - give them another try
          firstAttempt = false;
          document.getElementById('answer-input').value = '';
          document.getElementById('feedback-warning').classList.add('visible');
          document.getElementById('answer-input').focus();
        } else {
          // Either not in ballpark, or second attempt - mark as wrong
          stats.total++;
          document.getElementById('score-correct').textContent = stats.correct;
          document.getElementById('score-total').textContent = stats.total;
          
          // Track consecutive failures
          failureTracking[failureKey] = (failureTracking[failureKey] || 0) + 1;
          const consecutiveFailures = failureTracking[failureKey];
          
          showAnswer = true;
          document.getElementById('answer-input').disabled = true;
          document.getElementById('feedback-warning').classList.remove('visible');
          
          const feedbackResult = document.getElementById('feedback-result');
          feedbackResult.classList.add('visible', 'incorrect');
          document.getElementById('feedback-title').textContent = '‚úó Incorrect';
          document.getElementById('feedback-answer').textContent = correctAnswer;
          
          // Generate explanation
          let explanation = getErrorExplanation(userAnswer, correctAnswer, currentVerb, currentVerb.form);
          
          // After 2-3 failures, show a worked example
          if (consecutiveFailures >= 2 && Math.random() < 0.7) { // 70% chance after 2+ failures
            explanation += generateWorkedExample(currentVerb, currentVerb.form);
          }
          
          const explanationEl = document.getElementById('feedback-explanation');
          explanationEl.innerHTML = explanation;
          explanationEl.style.display = 'block';
          
          document.getElementById('check-btn').style.display = 'none';
          document.getElementById('next-btn').style.display = 'block';
        }
      }
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter' && !showAnswer) {
        checkAnswer();
      }
    }

    // Enable/disable check button based on input
    document.getElementById('answer-input').addEventListener('input', function() {
      document.getElementById('check-btn').disabled = this.value.trim() === '';
    });

    // Initialize
    generateNewQuestion();
  </script>
</body>
</html>
